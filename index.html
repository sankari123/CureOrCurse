<!DOCTYPE html>
<html>
  <head>
    <title>locateME@XPressAvenue</title>

    <script type="text/javascript" charset="utf-8" src="phonegap-1.2.0.js"></script>
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script type="text/javascript" charset="utf-8">
    // Wait for PhoneGap to load
    //
    document.addEventListener("deviceready", onDeviceReady, false);
    var watchID = null;
    var place_name;
    function onDeviceReady() {
    	//console.log(FileTransfer);
          tx.executeSql('CREATE TABLE IF NOT EXISTS locateME (data1,data2,data3)');
    }
function getloc()
{
//	alert("in");
  var options = { enableHighAccuracy: true };
        watchID = navigator.geolocation.watchPosition(onSuccess1, onError1, options);
     //   alert("in");
}
var geo_loc;
var geo_loc1;
function onSuccess1(position) {
//alert(position.coords.latitude);
//alert(position.coords.longitude);
	
geo_loc = position.coords.latitude;
   geo_loc1 = position.coords.longitude;
 document.getElementById('loc_txt').value=geo_loc;
    document.getElementById('loc_txt1').value=geo_loc1;
    }
    function onError1(error) {
          console.log('code: '    + error.code    +  'message: ' + error.message );
        }
        function placeloc()
        {
           place_name=document.getElementById("place_txt").value;
     //     alert(place_name);
        }
        
function saveloc()
{
	place_name=document.getElementById("place_txt").value;
	var db = window.openDatabase("locateME", "1.0", "locateME DB", 200000);
        db.transaction(populateDB, errorCB, successCB);
//alert(geo_loc);
//alert(geo_loc1);
//alert(place_name);
//alert(document.getElementById("place_txt").value);
}

function populateDB(tx) {
    //    tx.executeSql('DROP TABLE IF EXISTS DEMO');
     
     //   tx.executeSql('INSERT INTO locateME VALUES ('"&geo_loc&"','"&geo_loc1&";)');
     
  
        var sql='INSERT INTO locateME (data1,data2,data3) VALUES ("' + geo_loc+ '","' + geo_loc1+ '","' + place_name+ '")';
       // alert(sql);
          tx.executeSql(sql);
       // tx.executeSql('INSERT INTO DEMO (id, data) VALUES (2, "Second row")');
    }
    function errorCB(err) {
        console.log("Error processing SQL: "+err.code);
    }

    // Transaction success callback
    //
    function successCB() {
        var db = window.openDatabase("locateME", "1.0", "locateME DB", 200000);
        db.transaction(queryDB, errorCB);
    }
    function queryDB(tx) {
        tx.executeSql('SELECT * FROM locateME', [], querySuccess, errorCB);
    }
    var len;
    function querySuccess(tx, results) {
    	var myTable = document.getElementById('dbTable');
        len = results.rows.length;
        alert(len);
        console.log("locateME table: " + len + " rows found.");
        for (var i=0; i<len; i++){
        //	alert(results.rows.item(i).data1);
        //	alert(results.rows.item(i).data2);
        
	//	myTable.rows[i].cells[1].innerHTML = results.rows.item(i).data1;
	//	myTable.rows[i].cells[2].innerHTML = results.rows.item(i).data2;
	//	myTable.rows[i].cells[3].innerHTML = results.rows.item(i).data3;
		
           // console.log("Row = " + i + " ID = " + results.rows.item(i).data1 + " Data =  " + results.rows.item(i).data2);
        }
      //  addTable();
       }
    
   function addTable() {
      
    var myTableDiv = document.getElementById("myDynamicTable");
      
    var table = document.createElement('TABLE');
    table.border='1';
    
    var tableBody = document.createElement('TBODY');
    table.appendChild(tableBody);
      
    for (var i=0; i<len; i++){
       var tr = document.createElement('TR');
       tableBody.appendChild(tr);
       
       for (var j=0; j<4; j++){
           var td = document.createElement('TD');
           td.width='75';
           td.appendChild(document.createTextNode("Cell " + i + "," + j));
           tr.appendChild(td);
       }
    }
    myTableDiv.appendChild(table);
    
}
    
    
    </script>
    <style>
      .btncss
	{
	background:none;
	border:none;
	padding:0;
	cursor:pointer;
	font: 8pt arial;
	font-family:Oswald, sans-serif; /*Oswald is available from http://www.google.com/webfonts/specimen/Oswald*/
	color: #b32d5f;
	}

    </style>
  </head>
  <body>
    <h1>locateME</h1>
    <p>Database</p>
    <input type=text id=loc_txt><input type=text id=loc_txt1><button onclick="getloc();" class="btncss">Get Latitude and Longitude</button><br>
    <input type=text id=place_txt><button onclick="placeloc();" class="btncss">Enter Place Name</button><br>
    <button onclick="saveloc();" class="btncss">Save Location</button><br>
    <div id="myDynamicTable">
    	<input type="button" id="create" value="Display Results" onclick="addTable();">
    </div>
    
    
  </body>
</html>
